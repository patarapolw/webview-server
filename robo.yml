# Commands

run:
  command: |
    go build -o webview-server
    ./webview-server
build-mac:
  command: |
    if [[ $(go env GOOS) == 'darwin' ]]; then
      FILENAME=webview-server-mac

      go build -o $FILENAME

      if [ -f "config.json" ]; then
        WEBPATH=$(cat config.json | grep -v "^\s*//"  | jq .path)
      fi

      mkdir -p $FILENAME.app/Contents/MacOS
      mkdir -p $FILENAME.app/Contents/Resources
      cp Info.plist $FILENAME.app/Contents/Info.plist
      cp $FILENAME $FILENAME.app/Contents/MacOS/$FILENAME
      cp config.json $FILENAME.app/Contents/MacOS/config.json >/dev/null 2>&1 || true
      cp index.html $FILENAME.app/Contents/MacOS/index.html >/dev/null 2>&1 || true
      cp icon.icns $FILENAME.app/Contents/Resources/icon.icns >/dev/null 2>&1 || true

      zip $FILENAME.zip ./$FILENAME.app
    fi
build-all:
  summary: |
    Build for Linux and Windows
    Install using `go get github.com/karalabe/xgo`
  command: |
    for arch in amd64 i386
    do
      docker run --rm -v \
        "$PWD":/usr/src/webview-server \
        -w /usr/src/webview-server \
        patarapolw/webview-$arch \
        go build -o "webview-server-linux-$arch"
    done

    $(go env GOPATH)/bin/xgo \
      -ldflags="-H windowsgui" \
      -targets=windows/* \
      {{.repo}}
docker-build:
  command: |
    for arch in amd64 i386
    do
      docker build -t {{.docker}}-$arch -f Dockerfile.$arch .
    done
docker-push:
  command: |
    for arch in amd64 i386
    do
      docker push {{.docker}}-$arch
    done

##########
# Settings

variables:
  repo: github.com/patarapolw/webview-server
  docker: patarapolw/webview
