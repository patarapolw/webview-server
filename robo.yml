# Commands

run:
  command: |
    go build -o webview-server
    WINDOW=1 ./webview-server
build-mac:
  command: |
    if [[ $(go env GOOS) == 'darwin' ]]; then
      go build -o webview-server-mac.app
    fi
build-all:
  summary: |
    Build for Linux and Windows
    Install using `go get github.com/karalabe/xgo`
  command: |
    for arch in amd64 i386
    do
      docker run --rm -v \
        "$PWD":/usr/src/webview-server \
        -w /usr/src/webview-server \
        patarapolw/webview-$arch \
        go build -o "webview-server-linux-$arch"
    done

    $(go env GOPATH)/bin/xgo \
      -ldflags="-H windowsgui" \
      -targets=windows/* \
      {{.repo}}

    $(go env GOPATH)/bin/xgo \
      -targets=darwin/amd64 \
      {{.repo}}
docker-build:
  command: |
    for arch in amd64 i386
    do
      docker build -t {{.docker}}-$arch -f Dockerfile.$arch .
    done
docker-push:
  command: |
    for arch in amd64 i386
    do
      docker push {{.docker}}-$arch
    done

##########
# Settings

variables:
  repo: github.com/patarapolw/webview-server
  docker: patarapolw/webview
